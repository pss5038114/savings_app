<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>조립 PC 자금 플랜</title>
<!-- PWA -->
<link href="manifest.webmanifest" rel="manifest"/>
<meta content="#0b0f15" name="theme-color"/>
<link href="icons/icon-192.png" rel="apple-touch-icon"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<style>
  :root{--bg:#0b0f15;--panel:#121826;--txt:#e7eefb;--muted:#9fb0c9;--acc:#7aa2ff;--good:#6ee7a8;--warn:#ffd166;--bad:#ff7b7b;--orange:#ffb86b;--green:#6ee7a8;--gray:#94a3b8}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic",sans-serif;background:var(--bg);color:var(--txt)}
  header{position:sticky;top:0;background:linear-gradient(180deg,rgba(18,24,38,.98),rgba(18,24,38,.85));backdrop-filter:blur(6px);padding:14px 16px;border-bottom:1px solid #1f2a44;z-index:5}
  header h1{margin:0;font-size:16px}
  main{padding:12px 12px calc(96px + env(safe-area-inset-bottom));max-width:960px;margin:0 auto;min-height:100%}
  .card{background:var(--panel);border:1px solid #1f2a44;border-radius:16px;padding:14px;margin-bottom:10px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .row + .row{margin-top:8px}
  .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
  input,select,textarea{width:100%;background:#101624;color:var(--txt);border:1px solid #263451;border-radius:12px;padding:10px 12px;outline:none;min-width:0}
  input:focus,textarea:focus{border-color:var(--acc);box-shadow:0 0 0 3px rgba(122,162,255,.16)}
  button{background:#1b2a4b;color:var(--txt);border:1px solid #2a3d66;border-radius:12px;padding:10px 12px;cursor:pointer}
  button.primary{background:#27468f;border-color:#3159b6}
  button.danger{background:#5a1f2a;border-color:#7a2b3a}
  button.ghost{background:transparent;border-color:#2a3d66;color:var(--muted)}
  .split{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:8px}
  .muted{color:var(--muted);font-size:12px}
  .pill{padding:2px 8px;border:1px solid #2a3d66;border-radius:999px;font-size:12px}
  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .dangerText{color:var(--bad)}
  .hide{display:none}
  .nowrap{white-space:nowrap}

  /* 링 그래프 */
  .ring-outer{display:flex;justify-content:center;width:100%}
  .ring{width:min(56vw,220px);height:min(56vw,220px);position:relative;display:grid;place-items:center}
  .ring svg{width:100%;height:100%;transform:rotate(-90deg);display:block}
  .ring .center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
  .ring .center #home-percent{font-size:28px;font-weight:800}

  /* 하단 네비 */
  nav{position:fixed;left:0;right:0;bottom:0;height:76px;background:rgba(18,24,38,.98);backdrop-filter:blur(6px);border-top:1px solid #1f2a44;display:grid;grid-template-columns:repeat(5,1fr);padding-bottom:env(safe-area-inset-bottom);z-index:6}
  nav button{appearance:none;background:transparent;border:none;padding:10px 6px;color:var(--muted)}
  nav button.active{color:var(--txt)}

  .flex{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .legend{display:flex;gap:12px;align-items:center}
  .dot{width:10px;height:10px;border-radius:50%}
  .dot.gray{background:var(--gray)}.dot.orange{background:var(--orange)}.dot.green{background:var(--green)}

  /* 자금 막대그래프 */
  .bars{display:grid;gap:8px;margin-bottom:8px}
  .bar{height:12px;background:#09111f;border:1px solid #1f2a44;border-radius:999px;overflow:hidden}
  .bar>div{height:100%}
  .bar .fixed{background:var(--gray)}
  .bar .float{background:var(--orange)}
  .bar .invest{background:var(--green)}
  .barrow{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--muted)}

  /* 캘린더 */
  #cal-grid{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:6px}
  .cal-cell{padding:8px;border-radius:12px;border:1px solid #1f2a44;background:#101624;color:inherit;min-height:66px;text-align:left}
  .pct{font-feature-settings:"tnum" 1;display:inline-block;min-width:42px}

  /* 부품 카드형 */
  .p-cards{display:grid;gap:10px;margin-top:14px}
  .p-card{border:1px solid #1f2a44;background:#0f1524;border-radius:14px;padding:12px}
  .p-card .hbox{display:grid;grid-template-columns:96px 1fr;gap:12px;align-items:start}
  .thumb{width:96px;height:96px;border-radius:12px;background:#0b1220;border:1px solid #243055;display:grid;place-items:center;color:var(--muted);overflow:hidden;cursor:pointer}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .p-card .head{display:flex;align-items:center;gap:8px}
  .p-card .title{flex:1}
  .p-card .meta{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
  .p-card .sum{margin-top:10px}
  .p-card .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}

  /* 모바일 */
  @media (max-width: 640px){
    main{padding:10px 10px calc(96px + env(safe-area-inset-bottom))}
    .row,.row3{grid-template-columns:1fr}
    nav button{padding:10px 0;font-size:12px}
    .nowrap{white-space:normal}
    td input{font-size:14px}
  }
</style>
</head>
<body>
<header>
<h1>조립 PC 자금 플랜</h1>
<div class="muted" id="app-version">v2025.09.02-1</div>
</header>
<!-- 🔔 업데이트 배너 -->
<div class="card hide" id="update-banner" style="position:sticky;top:56px;z-index:50;max-width:960px;margin:8px auto">
<div style="font-weight:600">새 버전이 있어요.</div>
<div class="flex" style="justify-content:flex-end">
<button class="primary" id="btn-apply-update">업데이트</button>
<button class="ghost" id="btn-dismiss-update">닫기</button>
</div>
</div>
<main>
<!-- 홈 -->
<section class="card" id="view-home">
<div class="dash">
<div class="dash-title" style="font-size:18px;font-weight:700">대시보드</div>
<div class="ring-outer">
<div class="ring">
<svg preserveaspectratio="xMidYMid meet" viewbox="0 0 220 220">
<circle cx="110" cy="110" fill="none" r="88" stroke="#1f2a44" stroke-width="14"></circle>
<circle cx="110" cy="110" fill="none" id="seg-invest" r="88" stroke="#6ee7a8" stroke-linecap="round" stroke-width="14"></circle>
<circle cx="110" cy="110" fill="none" id="seg-fixed" r="88" stroke="#94a3b8" stroke-linecap="round" stroke-width="14"></circle>
<circle cx="110" cy="110" fill="none" id="seg-float" r="88" stroke="#ffb86b" stroke-linecap="round" stroke-width="14"></circle>
</svg>
<div class="center"><div id="home-percent">0%</div></div>
</div>
</div>
<div>
<div id="home-summary" style="font-size:18px;font-weight:700">-</div>
<div class="muted" id="home-sub">-</div>
</div>
</div>
<div class="legend" style="margin-top:8px">
<div class="dot gray"></div><span class="muted">부동</span>
<div class="dot orange"></div><span class="muted">입출금</span>
<div class="dot green"></div><span class="muted">구매누계</span>
</div>
<div class="muted" id="home-extra" style="margin-top:6px"> </div>
<div class="flex" style="margin-top:10px">
<button class="primary" id="btn-settle">정산(일부 이체)</button>
<span class="muted">입출금 → 부동으로 금액을 옮깁니다.</span>
</div>
</section>
<!-- 부품 -->
<section class="card hide" id="view-parts">
<div class="split">
<h3 style="margin:0">부품 리스트</h3>
<button id="btn-add-part">+ 추가</button>
</div>
<div class="p-cards" id="parts-cards"></div>
</section>
<!-- 자금 -->
<section class="card hide" id="view-funds">
<div class="split"><h3 style="margin:0">자금 관리</h3><span class="muted" id="funds-balance">-</span></div>
<div class="bars" id="fund-bars">
<div class="barrow"><span>부동</span><span id="bar-fixed-label">0%</span></div>
<div class="bar"><div class="fixed" id="bar-fixed" style="width:0%"></div></div>
<div class="barrow"><span>입출금</span><span id="bar-float-label">0%</span></div>
<div class="bar"><div class="float" id="bar-float" style="width:0%"></div></div>
<div class="barrow"><span>구매누계</span><span id="bar-invest-label">0%</span></div>
<div class="bar"><div class="invest" id="bar-invest" style="width:0%"></div></div>
</div>
<div class="row">
<div>
<label>구분</label>
<select id="txn-kind"><option value="income">+ 입금</option><option value="expense">- 지출</option></select>
</div>
<div>
<label>계좌</label>
<select id="txn-acct"><option value="floating">입출금</option><option value="fixed">부동</option></select>
</div>
</div>
<div class="row" style="margin-top:10px">
<div><label>금액(원)</label><input id="txn-amt" inputmode="numeric" placeholder="예: 600000"/></div>
<div><label>메모</label><input id="txn-memo" placeholder="예: 용돈/식비 등"/></div>
</div>
<div class="flex" style="margin-top:12px">
<button class="primary" id="btn-add-txn">적용</button>
<button id="btn-quick-settle">정산(일부)</button>
</div>
</section>
<!-- 캘린더 -->
<section class="card hide" id="view-cal">
<div class="split">
<h3 style="margin:0">캘린더</h3>
<div class="flex"><button id="btn-prev">◀</button><div class="muted" id="cal-title"></div><button id="btn-next">▶</button></div>
</div>
<div id="cal-grid" style="margin-top:8px"></div>
<div class="card" id="cal-detail" style="margin-top:10px"></div>
</section>
<!-- 메모 -->
<section class="card hide" id="view-memo">
<div class="split"><h3 style="margin:0">메모</h3><button id="btn-add-memo">+ 추가</button></div>
<div class="grid" id="memo-list"></div>
</section>
<section id="accounts">
<h2>계좌</h2>
<div class="accounts-toolbar">
<input id="new-account-name" placeholder="계좌 이름 (예: 입출금, 적금, 테스트)"/>
<button id="btn-add-account">계좌 추가</button>
</div>
<ul class="card-list" id="accounts-list"></ul>
<p class="hint">* 최소 2개 이상의 계좌를 유지해야 합니다. 삭제 시 잔액이 있으면 이체 대상 선택 창이 뜹니다.</p>
</section><section id="transfer">
<h2>이체</h2>
<div class="transfer-form">
<label>From
    <select id="transfer-from"></select>
</label>
<label>To
    <select id="transfer-to"></select>
</label>
<label>금액
    <input id="transfer-amount" min="0" step="1" type="number"/>
</label>
<button id="btn-do-transfer">이체</button>
</div>
</section><section id="settings">
<h2>설정</h2>
<div class="settings">
<label>목표 금액
    <input id="input-goal" min="0" step="1" type="number"/>
</label>
<button id="btn-save-goal">저장</button>
</div>
</section></main>
<nav><button class="active" data-view="home">홈</button><button data-view="parts">부품</button><button data-view="accounts">계좌</button><button data-view="transfer">이체</button><button data-view="cal">캘린더</button><button data-view="memo">메모</button><button data-view="settings">설정</button></nav>


<script>
(()=>{
  'use strict';

  const LS_KEY = 'pc-goal-mvp-v6';
  const $ = (sel, root=document)=>root.querySelector(sel);
  const $$ = (sel, root=document)=>Array.from(root.querySelectorAll(sel));

  // --- State ---
  let state = load();

  function defaultAccounts(){
    return [
      {id: genId(), name: '입출금', deleted:false},
      {id: genId(), name: '적금', deleted:false},
    ];
  }

  function load(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw){
        return {goal: 1000000, accounts: defaultAccounts(), txns: [], parts: [], memos: []};
      }
      const s = JSON.parse(raw);
      if(!s.accounts || !Array.isArray(s.accounts) || s.accounts.length<2){
        s.accounts = defaultAccounts();
      }
      if(!s.txns)s.txns=[];
      if(!s.parts)s.parts=[];
      if(!s.memos)s.memos=[];
      if(typeof s.goal!=='number') s.goal = 1000000;

      // migration from old 'floating/fixed' keys if present
      if(s.txns.length && typeof s.txns[0].from === 'string'){
        const chk = s.accounts.find(a=>a.name==='입출금') || s.accounts[0];
        const sav = s.accounts.find(a=>a.name==='적금') || s.accounts[1];
        s.txns = s.txns.map(t=>{
          const c = {...t};
          if(c.from==='floating') c.from = chk.id;
          if(c.from==='fixed') c.from = sav.id;
          if(c.to==='floating') c.to = chk.id;
          if(c.to==='fixed') c.to = sav.id;
          return c;
        });
      }
      save(s);
      return s;
    }catch(e){
      console.error(e);
      return {goal: 1000000, accounts: defaultAccounts(), txns: [], parts: [], memos: []};
    }
  }
  function save(s=state){
    localStorage.setItem(LS_KEY, JSON.stringify(s));
  }
  function genId(){ return Math.random().toString(36).slice(2,10); }
  function fmt(n){
    return (n||0).toLocaleString('ko-KR');
  }

  function activeAccounts(){
    return state.accounts.filter(a=>!a.deleted);
  }
  function getAccountById(id){ return state.accounts.find(a=>a.id===id); }
  function getAccountByName(name){ return activeAccounts().find(a=>a.name===name); }

  // --- Compute ---
  function compute(){
    const bal = {};
    for(const a of state.accounts){ bal[a.id]=0; }
    for(const t of state.txns){
      if(t.type==='income' && t.to){ bal[t.to]+=t.amount; }
      if(t.type==='expense' && t.from){ bal[t.from]-=t.amount; }
      if(t.type==='transfer' && t.from && t.to){ bal[t.from]-=t.amount; bal[t.to]+=t.amount; }
      if(t.type==='adjust' && t.to){ bal[t.to]+=t.amount; } // manual adjust
    }
    const invested = state.parts.filter(p=>p.purchased).reduce((s,p)=>s+Number(p.price||0),0);
    const total = Object.keys(bal).reduce((s,id)=>{
      const a = getAccountById(id);
      return a && !a.deleted ? s + bal[id] : s;
    },0);
    // for ring segments: chk = '입출금', savlike = total - chk
    const chk = (getAccountByName('입출금') ? bal[getAccountByName('입출금').id] : 0);
    const savlike = Math.max(0, total - chk);
    return {bal, invested, total, chk, savlike};
  }

  // --- Views switching ---
  function show(view){
    $$('.views > section').forEach(sec=>sec.style.display = (sec.id===view?'block':'none'));
    $$('nav button').forEach(b=>b.classList.toggle('active', b.dataset.view===view));
    if(view==='home') renderHome();
    if(view==='parts') renderParts();
    if(view==='accounts') renderAccounts();
    if(view==='transfer') renderTransfer();
    if(view==='cal') renderCalendar();
    if(view==='memo') renderMemo();
    if(view==='settings') renderSettings();
  }

  // --- Home ---
  function renderHome(){
    const {invested,total,chk,savlike} = compute();
    const goal = state.goal||0;
    const pct = goal>0 ? Math.min(100, Math.floor(total/goal*100)) : 0;

    // Numbers
    const tEl = $('#dash-total'); if(tEl) tEl.textContent = fmt(total);
    const iEl = $('#dash-invested'); if(iEl) iEl.textContent = fmt(invested);
    const cEl = $('#dash-chk'); if(cEl) cEl.textContent = fmt(chk);
    const sEl = $('#dash-sav'); if(sEl) sEl.textContent = fmt(savlike);
    const pEl = $('#dash-pct'); if(pEl) pEl.textContent = pct + '%';

    // Ring
    const r = $('#ring');
    if(r){
      const sum = goal || (invested+savlike+chk);
      const segInvest = sum>0 ? invested/sum*360 : 0;
      const segSav = sum>0 ? savlike/sum*360 : 0;
      const segChk = sum>0 ? chk/sum*360 : 0;
      r.style.setProperty('--seg-invest', segInvest.toFixed(2)+'deg');
      r.style.setProperty('--seg-sav', segSav.toFixed(2)+'deg');
      r.style.setProperty('--seg-chk', segChk.toFixed(2)+'deg');
    }
  }

  // --- Parts ---
  function renderParts(){
    const list = $('#parts-list');
    list.innerHTML='';
    if(!state.parts.length){
      const li = document.createElement('li');
      li.className='empty';
      li.textContent='부품이 없습니다.';
      list.appendChild(li);
    }else{
      state.parts.forEach((p,idx)=>{
        const li = document.createElement('li');
        li.className='card';
        li.innerHTML = \`
          <div class="row">
            <div class="grow">
              <div class="ttl">\${p.name}</div>
              <div class="sub">\${fmt(p.price||0)}원</div>
            </div>
            <div class="actions">
              <button data-act="buy" data-idx="\${idx}">\${p.purchased?'구매취소':'구매처리'}</button>
              <button data-act="del" data-idx="\${idx}">삭제</button>
            </div>
          </div>\`;
        list.appendChild(li);
      });
    }
  }
  $('#parts-list')?.addEventListener('click', (e)=>{
    const btn = e.target.closest('button[data-act]');
    if(!btn) return;
    const idx = Number(btn.dataset.idx);
    const act = btn.dataset.act;
    if(act==='del'){
      state.parts.splice(idx,1);
      save();
      renderParts(); renderHome();
      return;
    }
    if(act==='buy'){
      const p = state.parts[idx];
      p.purchased = !p.purchased;
      // record expense from 입출금 when purchasing, refund when un-purchasing
      const payAcc = getAccountByName('입출금') || activeAccounts()[0];
      if(payAcc){
        state.txns.push({
          id: genId(),
          dt: new Date().toISOString().slice(0,10),
          type: p.purchased ? 'expense' : 'income',
          from: p.purchased ? payAcc.id : undefined,
          to: p.purchased ? undefined : payAcc.id,
          amount: Number(p.price||0),
          memo: '부품 ' + (p.purchased?'구매':'구매취소') + ': ' + p.name
        });
      }
      save();
      renderParts(); renderHome();
    }
  });
  $('#btn-add-part')?.addEventListener('click', ()=>{
    const name = prompt('부품 이름?');
    if(!name) return;
    const price = Number(prompt('가격(원)?')||'0')||0;
    state.parts.push({id:genId(), name, price, purchased:false});
    save(); renderParts(); renderHome();
  });

  // --- Accounts ---
  function renderAccounts(){
    const ul = $('#accounts-list');
    ul.innerHTML='';
    const {bal} = compute();
    activeAccounts().forEach((a, i)=>{
      const li = document.createElement('li');
      li.className='card';
      li.innerHTML = \`
        <div class="row">
          <div class="grow">
            <div class="ttl">\${a.name}</div>
            <div class="sub">잔액 \${fmt(bal[a.id]||0)}원</div>
          </div>
          <div class="actions">
            <button data-act="rename" data-id="\${a.id}">이름변경</button>
            <button data-act="delete" data-id="\${a.id}">삭제</button>
          </div>
        </div>\`;
      ul.appendChild(li);
    });
  }
  $('#accounts-list')?.addEventListener('click', (e)=>{
    const btn = e.target.closest('button[data-act]');
    if(!btn) return;
    const id = btn.dataset.id;
    const act = btn.dataset.act;
    if(act==='rename'){
      const a = getAccountById(id);
      const name = prompt('새 이름?', a.name);
      if(!name) return;
      a.name = name;
      save(); renderAccounts(); renderHome(); renderTransfer();
    }else if(act==='delete'){
      const acc = getAccountById(id);
      const actives = activeAccounts();
      if(actives.length<=2){
        alert('최소 2개 계좌를 유지해야 합니다.');
        return;
      }
      // compute balance
      const {bal} = compute();
      const balAmt = bal[id]||0;
      if(Math.abs(balAmt) > 0){
        // ask destination
        const dests = actives.filter(a=>a.id!==id);
        const names = dests.map((a,idx)=> \`\${idx+1}. \${a.name}\`).join('\n');
        const pick = prompt(\`잔액 \${fmt(balAmt)}원을 어디로 옮길까요?\n\${names}\n번호를 입력하세요\`);
        const idx = Number(pick)-1;
        if(!(idx>=0 && idx<dests.length)) return;
        const to = dests[idx];
        // create transfer txn
        state.txns.push({id:genId(), dt:new Date().toISOString().slice(0,10), type:'transfer', from:id, to:to.id, amount:Math.abs(balAmt), memo:'계좌 삭제 정산'});
      }
      // soft delete
      acc.deleted = true;
      save(); renderAccounts(); renderHome(); renderTransfer();
    }
  });
  $('#btn-add-account')?.addEventListener('click', ()=>{
    const name = ($('#new-account-name').value || '').trim();
    if(!name) return;
    state.accounts.push({id:genId(), name, deleted:false});
    $('#new-account-name').value='';
    save(); renderAccounts(); renderTransfer(); renderHome();
  });

  // --- Transfer ---
  function renderTransfer(){
    const fromSel = $('#transfer-from'), toSel=$('#transfer-to');
    fromSel.innerHTML=''; toSel.innerHTML='';
    const accs = activeAccounts();
    accs.forEach(a=>{
      const o1=document.createElement('option'); o1.value=a.id; o1.textContent=a.name; fromSel.appendChild(o1);
      const o2=document.createElement('option'); o2.value=a.id; o2.textContent=a.name; toSel.appendChild(o2);
    });
    // defaults: From 입출금, To 적금
    const from = getAccountByName('입출금') || accs[0];
    const to = getAccountByName('적금') || accs.find(a=>a.id!==from.id) || accs[0];
    if(from) fromSel.value = from.id;
    if(to) toSel.value = to.id;
  }
  $('#btn-do-transfer')?.addEventListener('click', ()=>{
    const from = $('#transfer-from').value;
    const to = $('#transfer-to').value;
    const amt = Math.abs(Number($('#transfer-amount').value||'0'))||0;
    if(!from || !to || from===to || amt<=0){ alert('입력값을 확인하세요.'); return; }
    state.txns.push({id:genId(), dt:new Date().toISOString().slice(0,10), type:'transfer', from, to, amount:amt, memo:'이체'});
    $('#transfer-amount').value='';
    save(); renderHome();
  });

  // --- Calendar (simple render) ---
  function renderCalendar(){
    // Using existing static markup; nothing interactive required per user
  }

  // --- Memo ---
  function renderMemo(){
    const list = $('#memo-list');
    list.innerHTML='';
    const sel = $('#memo-sort');
    const order = sel?.value||'new';
    const arr = [...state.memos];
    arr.sort((a,b)=> order==='new' ? (b.ts - a.ts) : (a.ts - b.ts));
    for(const m of arr){
      const li = document.createElement('li');
      li.className='card';
      li.innerHTML = \`<div class="row"><div class="grow">\${m.text}</div><button data-id="\${m.id}">삭제</button></div>\`;
      list.appendChild(li);
    }
  }
  $('#memo-add')?.addEventListener('click', ()=>{
    const text = prompt('메모 입력');
    if(!text) return;
    state.memos.push({id:genId(), text, ts: Date.now()});
    save(); renderMemo();
  });
  $('#memo-sort')?.addEventListener('change', renderMemo);
  $('#memo-list')?.addEventListener('click', (e)=>{
    const id = e.target.dataset.id;
    if(!id) return;
    state.memos = state.memos.filter(m=>m.id!==id);
    save(); renderMemo();
  });

  // --- Settings ---
  function renderSettings(){
    $('#input-goal').value = state.goal||0;
  }
  $('#btn-save-goal')?.addEventListener('click', ()=>{
    state.goal = Math.abs(Number($('#input-goal').value||'0'))||0;
    save(); renderHome();
    alert('저장되었습니다.');
  });

  // --- Dashboard HTML injection ---
  const homeSec = $('#home');
  if(homeSec){
    homeSec.innerHTML = \`
      <h2>대시보드</h2>
      <div class="ring-wrap">
        <div id="ring" class="ring"></div>
        <div class="pct" id="dash-pct">0%</div>
      </div>
      <div class="stats">
        <div>구매누계: <b id="dash-invested">0</b>원</div>
        <div>적금(+기타): <b id="dash-sav">0</b>원</div>
        <div>입출금: <b id="dash-chk">0</b>원</div>
        <div>계좌 합계: <b id="dash-total">0</b>원</div>
      </div>\`;
  }

  // --- Styles for ring and layout tweaks ---
  const style = document.createElement('style');
  style.textContent = \`
  .views > section{ display:none; }
  nav{ position:sticky; bottom:0; display:flex; gap:6px; padding:8px; background:#fff; border-top:1px solid #eee; }
  nav button.active{ font-weight:bold; }
  .card-list{ list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px;}
  .card{ border:1px solid #eee; border-radius:10px; padding:10px; background:#fafafa; }
  .row{ display:flex; align-items:center; gap:8px; }
  .row .grow{ flex:1; }
  .ttl{ font-weight:600;}
  .sub{ font-size:12px; color:#666;}
  .actions button{ margin-left:6px; }
  .ring-wrap{ position:relative; width:180px; height:180px; margin:10px auto; }
  .ring{ --seg-invest:0deg; --seg-sav:0deg; --seg-chk:0deg;
         width:100%; height:100%; border-radius:50%;
         background:
           conic-gradient(#7aa7ff 0deg var(--seg-invest),
                          #a3e48f 0deg var(--seg-sav),
                          #ffd07a 0deg var(--seg-chk),
                          #eee 0deg 360deg);
         mask: radial-gradient(circle, rgba(0,0,0,0) 58%, rgba(0,0,0,1) 59%);
  }
  .pct{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:28px; font-weight:700;}
  .accounts-toolbar{ display:flex; gap:8px; }
  .transfer-form{ display:flex; gap:8px; flex-wrap:wrap; }
  .memo-toolbar{ display:flex; justify-content:flex-end; align-items:center; margin-bottom:6px; gap:8px; }
  \`;
  document.head.appendChild(style);

  // --- Navigation wiring ---
  document.querySelector('nav').addEventListener('click', (e)=>{
    const btn = e.target.closest('button[data-view]');
    if(!btn) return;
    show(btn.dataset.view);
  });

  // init
  show('home');
})();
</script>
</body>
</html>
